<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>

    <th:block layout:fragment="css">
        <style>
            .container {
                width: 90%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 40px 0;
            }

            .product-name {
                text-align: center;
                margin: 40px 0;
            }

            .product-name h2 {
                font-size: 2.5rem;
                font-weight: 700;
                color: #333;
                position: relative;
                display: inline-block;
            }

            .product-name h2::after {
                content: '';
                display: block;
                width: 60px;
                height: 3px;
           
                margin: 15px auto;
                border-radius: 2px;
            }

            .product-img {
                width: 100%;
                max-width: 500px;
                height: auto;
                display: block;
                margin: 0 auto;
                border-radius: 20px;
                box-shadow: 0 8px 20px rgba(0,0,0,0.1);
                transition: all 0.4s ease;
            }

            .product-img:hover {
                transform: scale(1.02);
                box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            }

            .price-section {
                padding: 30px;
                text-align: center;
                background: white;
                border-radius: 20px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.05);
                margin: 30px 0;
            }

            .price-section .h4 {
                font-size: 2rem;
                font-weight: 700;
                color: #d94e20;
                margin-bottom: 20px;
            }

            .input-group {
                margin: 20px auto;
                max-width: 200px;
            }

            .input-group .btn {
                padding: 8px 20px;
                font-size: 1.2rem;
                color: #d37b00;
                border-color: #d37b00;
            }

            .input-group .btn:hover {
                background-color: #d37b00;
                color: white;
            }

            .input-group input {
                border-color: #d37b00;
                font-size: 1.1rem;
            }

            .mgb-15 {
                margin: 30px 0;
            }

            .mgb-15 h5 {
                color: #666;
                font-size: 1.2rem;
                margin-bottom: 10px;
            }

            .mgb-15 h3 {
                color: #d94e20;
                font-size: 2.2rem;
                font-weight: 700;
                margin: 15px 0;
            }

            .btn-light.border-primary {
                background-color: white;
                color: #d37b00;
                border-color: #d37b00 !important;
                padding: 12px 30px;
                font-size: 1.1rem;
                font-weight: 600;
                transition: all 0.3s ease;
            }

            .btn-light.border-primary:hover {
                background-color: #d37b00;
                color: white;
                transform: translateY(-2px);
            }

            .product-detail {
                text-align: center;
                margin: 40px 0;
                padding: 30px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            }

            .product-detail h3 {
                color: #333;
                font-size: 1.8rem;
                font-weight: 600;
                margin-bottom: 20px;
            }

            .product-detail hr {
                border: none;
                height: 2px;
                background: #d37b00;
                width: 100px;
                margin: 20px auto;
            }

            .product-detail .lead {
                color: #666;
                font-size: 1.1rem;
                line-height: 1.8;
            }

            .info-section {
                margin-top: 40px;
                padding: 30px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            }

            .info-section h3 {
                color: #333;
                font-size: 1.5rem;
                font-weight: 600;
                border-bottom: 2px solid #d37b00;
                padding-bottom: 10px;
                margin: 30px 0 20px;
            }

            .info-section p {
                color: #666;
                font-size: 1.1rem;
                line-height: 1.8;
                margin-bottom: 15px;
            }

            .text-center .btn-secondary {
                background-color: #37474F;
                color: white;
                padding: 12px 30px;
                font-size: 1.1rem;
                font-weight: 600;
                border-radius: 10px;
                transition: all 0.3s ease;
            }

            .text-center .btn-secondary:hover {
                background-color: #d37b00;
                transform: translateY(-2px);
            }

            /* ë°˜ì‘í˜• ë””ìì¸ */
            @media (max-width: 768px) {
                .container {
                    width: 95%;
                    padding: 20px 0;
                }

                .product-name h2 {
                    font-size: 2rem;
                }

                .price-section {
                    padding: 20px;
                }

                .price-section .h4 {
                    font-size: 1.8rem;
                }

                .mgb-15 h3 {
                    font-size: 1.8rem;
                }

                .product-detail, .info-section {
                    padding: 20px;
                }

                .product-detail h3 {
                    font-size: 1.5rem;
                }

                .info-section h3 {
                    font-size: 1.3rem;
                }

                .product-detail .lead,
                .info-section p {
                    font-size: 1rem;
                }
            }
        </style>
    </th:block>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        function addCart() {
      var token = $("meta[name='_csrf']").attr("content");
      var header = $("meta[name='_csrf_header']").attr("content");

      var url = "/cart";

      var paramData = {
          itemId: Number($("#productId").val()),  // âœ… `Number()`ë¡œ ë³€í™˜í•˜ì—¬ `Long` íƒ€ì… ìœ ì§€
          count: parseInt($("#count").val(), 10) || 1  // âœ… `count`ë„ ìˆ«ìë¡œ ë³€í™˜
      };

      var param = JSON.stringify(paramData);

      console.log("ğŸ“Œ ì¥ë°”êµ¬ë‹ˆ ìš”ì²­ ë°ì´í„°:", paramData);  // âœ… ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€

      $.ajax({
          url: url,
          type: "POST",
          contentType: "application/json",
          data: param,
          beforeSend: function(xhr) {
              xhr.setRequestHeader(header, token);
          },
          dataType: "json",
          cache: false,
          success: function(result, status) {
              alert("ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤.");
              location.href = '/cart';  // âœ… ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ë¡œ ì´ë™
          },
          error: function(jqXHR, status, error) {
              if (jqXHR.status == 401) {
                  alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.');
                  location.href = '/members/login';
              } else {
                  alert("ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨: " + jqXHR.responseText);
              }
          }
      });
  }




                    $(document).ready(function(){
                              updateTotalPrice();
                              $("#count").change(function(){
                                 updateTotalPrice();
                              });

                          // âœ… ìˆ˜ëŸ‰ ì…ë ¥ê°’ ë³€ê²½ ì‹œ ê°€ê²© ì—…ë°ì´íŠ¸
                          $("#count").on("input", function () {
                              updateTotalPrice();
                          });

                          // âœ… ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                          $("#increaseBtn").on("click", function () {
                              changeCount(1);
                          });

                          $("#decreaseBtn").on("click", function () {
                              changeCount(-1);
                          });
                      });

                      // âœ… ìˆ˜ëŸ‰ ë³€ê²½ í•¨ìˆ˜
                    function changeCount(amount) {
                       let countInput = $("#count");
                       let count = Number(countInput.val()) || 1;

                       // âœ… ìµœì†Œ 1 ì´ìƒìœ¼ë¡œ ì„¤ì •
                       count = Math.max(1, count + amount);
                       countInput.val(count);

                       updateTotalPrice(); // âœ… ê°€ê²© ì—…ë°ì´íŠ¸ í˜¸ì¶œ
                   }

                      // âœ… ì´ ê°€ê²© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
                   function updateTotalPrice() {
                       var count = $("#count").val();
                       var price = $("#price").val();
                       var totalPrice = price * count;
                       $("#totalPrice").html(totalPrice.toLocaleString() + 'ì›');
                   }



                      // âœ… ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
             function redirectToPayment() {
                let productId = $("#productId").val();
                let productName = $("#productName").val();
                let count = parseInt($("#count").val(), 10) || 1;
                let price = parseInt($("#price").val(), 10) || 0;
                let totalPrice = price * count;

                console.log("ğŸ“Œ ìƒí’ˆ ID:", productId);
                console.log("ğŸ“Œ ìƒí’ˆëª…:", productName);
                console.log("ğŸ“Œ ìˆ˜ëŸ‰:", count);
                console.log("ğŸ“Œ ì´ ê°€ê²©:", totalPrice);

                if (!productId || isNaN(parseInt(productId, 10))) {
                    alert("âŒ ìƒí’ˆ IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }
                if (!productName || productName.trim() === "") {
                    alert("âŒ ìƒí’ˆëª…ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }
                if (isNaN(totalPrice) || totalPrice <= 0) {
                    alert("âŒ ì´ ê²°ì œ ê¸ˆì•¡ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }

                let encodedProductName = encodeURIComponent(productName);

                window.location.href = `/payment?productId=${productId}&productName=${encodedProductName}&count=${count}&totalPrice=${totalPrice}`;
            }


    </script>
</th:block>
<div layout:fragment="content">
    <input type="hidden" id="productId" th:value="${product.id}">

    <!-- ìƒí’ˆëª… -->
    <div class="product-name">
        <h2 th:text="${product.subject}"></h2>
    </div>

    <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
    <div class="text-center">
        <img th:src="${product.image}" alt="ìƒí’ˆ ì´ë¯¸ì§€" class="product-img">
    </div>

    <!-- ê°€ê²© ë° ì£¼ë¬¸ ì •ë³´ -->
    <div class="price-section">
        <div class="h4">
            <input type="hidden" th:value="${product.price}" id="price">
            <span th:text="${product.price}"></span>ì›
        </div>
    </div>

    <!-- ìƒí’ˆ ìƒì„¸ ì„¤ëª… -->
    <div class="product-detail">
        <h3>ìƒí’ˆ ìƒì„¸ ì •ë³´</h3>
        <hr>
        ìƒí’ˆëª… : <span th:text="${product.subject}"></span>
        <input type="hidden" th:value="${product.price}" id="price">
        ê°€ê²© :<span th:text="${product.price}"></span>ì›

        <p class="lead" th:if="${product.detail != null and product.detail != ''}" th:text="${product.detail}"></p>
        <p class="lead" th:unless="${product.detail != null and product.detail != ''}">
        
        </p>
        <br>
    </div>

    <!-- ê°€ê²© ë° ì£¼ë¬¸ ì •ë³´ -->
    <div class="price-section">
        <div class="h4">
            <input type="hidden" th:value="${product.price}" id="price">

            <span th:text="${product.price}"></span>ì›

        </div>

        <!-- ìˆ˜ëŸ‰ ì¡°ì ˆ ë²„íŠ¼ -->
        <div class="input-group w-50 text-center">
            <button id="decreaseBtn" class="btn btn-outline-secondary" type="button">-</button>
            <input type="number" name="count" id="count" class="form-control text-center" value="1" min="1" style="max-width:60px;">
            <button id="increaseBtn" class="btn btn-outline-secondary" type="button">+</button>
        </div>
        <div class="mgb-15 text-center">
            <h5>ê²°ì œ ê¸ˆì•¡</h5>

            <h3 id="totalPrice" class="font-weight-bold"></h3>
            <button type="button" class="btn btn-light border border-primary btn-lg" onclick="addCart()">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>

            <!--<button class="btn btn-primary" type="button" onclick="redirectToPayment()">ê²°ì œí•˜ê¸°</button>-->
        </div>
    </div>


    <!-- êµ¬ë¶„ì„  -->
    <hr class="my-4">

    <!-- ê³µí†µ ë°°ì†¡ / ë°˜í’ˆ / AS ì•ˆë‚´ -->
    <div class="info-section">
        <h3>ğŸ“¦ ë°°ì†¡ ì•ˆë‚´</h3>
        <p>ğŸšš ë°°ì†¡ ë°©ë²• : íƒë°°</p>
        <p>ğŸ“ ë°°ì†¡ ì§€ì—­ : ì „êµ­</p>
        <p>ğŸ’° ë°°ì†¡ ë¹„ìš© : 2,500ì›</p>
        <p>â³ ë°°ì†¡ ê¸°ê°„ : 1ì¼ ~ 3ì¼</p>
        <p>ê³ ê°ë‹˜ê»˜ì„œ ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì€ ì›”~ê¸ˆ(ê³µíœ´ì¼ ì œì™¸) 14ì‹œ ì „ ì…ê¸ˆ ì™„ë£Œëœ ê±´ì— í•œí•´ ë‹¹ì¼ ì¶œê³ ë©ë‹ˆë‹¤.</p>
        <p>4ë§Œì› ë¯¸ë§Œ êµ¬ë§¤ ì‹œ ê¸°ë³¸ ë°°ì†¡ë¹„(2,500ì›)ê°€ ë¶€ê³¼ë©ë‹ˆë‹¤.</p>

        <h3>ğŸ”„ êµí™˜ ë° ë°˜í’ˆ ì•ˆë‚´</h3>
        <p>ğŸ“ ë°˜í’ˆ ì£¼ì†Œ : ì¸ì²œê´‘ì—­ì‹œ ë¶€í‰êµ¬  ì´ì§€íŠ¸ë˜ë¸”</p>
        <p>ğŸ“Œ ìƒí’ˆ íƒ(tag)ì œê±° ë˜ëŠ” ê°œë´‰ìœ¼ë¡œ ìƒí’ˆ ê°€ì¹˜ í›¼ì† ì‹œì—ëŠ” êµí™˜ ë° ë°˜í’ˆì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        <p>ğŸ“Œ ê³ ê° ë³€ì‹¬ì— ì˜í•œ êµí™˜, ë°˜í’ˆì€ ê³ ê°ë‹˜ ë¶€ë‹´ (ì œí’ˆ í•˜ì ì œì™¸)</p>
        <p>ğŸ“Œ ì£¼ë¬¸ì œì‘ìƒí’ˆì˜ ê²½ìš° ì œì‘ ì™„ë£Œ í›„ì—ëŠ” êµí™˜ ë° ë°˜í’ˆì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

        <h3>ğŸ›  AS ì•ˆë‚´</h3>
        <p>ğŸ”§ ì´ì§€íŠ¸ë˜ë¸” ë¸Œëœë“œ ì œí’ˆì€ êµ¬ë§¤ í›„ 1ë…„ ë™ì•ˆ ë¬´ìƒ ASê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        <p>ğŸ“ AS ì‹ ì²­ ë° ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ : ê³ ê°ì„¼í„° ì „í™” 1234-5678 ë˜ëŠ” í™ˆí˜ì´ì§€ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜ì£¼ì„¸ìš”</p>
    </div>

    <!-- ìƒí’ˆ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° -->
    <div class="text-center" style="margin-top: 20px;">
        <a href="/product" class="btn btn-secondary">â† ìƒí’ˆ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

        <!-- âœ… productId, productName ê°’ì´ ì‹¤ì œë¡œ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸
        <p>ìƒí’ˆ ID: <span th:text="${product.id}"></span></p>
        <p>ìƒí’ˆëª…: <span th:text="${product.subject}"></span></p> -->

        <!-- âœ… input íƒœê·¸ ê°’ í™•ì¸ -->
        <input type="hidden" id="productId" th:value="${product.id}">
        <input type="hidden" id="productName" th:value="${product.subject}">

        <!-- âœ… product ê°ì²´ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ -->


    </div>




</div>
</html>
